<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>登录 - 智能旅行规划系统</title>
    
    <!-- 引入Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- 引入Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- 引入Element Plus -->
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
    <!-- 引入Element Plus组件库 -->
    <script src="https://unpkg.com/element-plus/dist/index.full.js"></script>
    <!-- 引入Axios -->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #f5f7fa;
            color: #303133;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .auth-container {
            background-color: white;
            border-radius: 8px;
            padding: 40px;
            box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 400px;
        }

        .auth-title {
            font-size: 24px;
            font-weight: bold;
            color: #409EFF;
            margin-bottom: 30px;
            text-align: center;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #303133;
            font-weight: 500;
            font-size: 14px;
        }

        input {
            padding: 10px 15px;
            border: 1px solid #dcdfe6;
            border-radius: 4px;
            font-size: 14px;
            width: 100%;
            transition: border-color 0.3s;
        }

        input:focus {
            outline: none;
            border-color: #409EFF;
        }

        .btn {
            padding: 10px 20px;
            background-color: #409EFF;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            width: 100%;
            transition: background-color 0.3s;
        }

        .btn:hover {
            background-color: #66b1ff;
        }

        .btn:disabled {
            background-color: #a0cfff;
            cursor: not-allowed;
        }

        .link-text {
            margin-top: 20px;
            text-align: center;
            font-size: 14px;
            color: #606266;
        }

        .link-text a {
            color: #409EFF;
            text-decoration: none;
        }

        .error-message {
            color: #f56c6c;
            font-size: 12px;
            margin-top: 5px;
        }
    </style>
</head>

<body>
    <div class="auth-container" id="app">
        <h1 class="auth-title">智能旅行规划系统</h1>
        <form @submit.prevent="handleLogin">
            <div class="form-group">
                <label for="username">用户名</label>
                <input type="text" id="username" v-model="form.username" placeholder="请输入用户名" required>
            </div>
            <div class="form-group">
                <label for="password">密码</label>
                <input type="password" id="password" v-model="form.password" placeholder="请输入密码" required>
            </div>
            <button type="submit" class="btn" :disabled="loading">{{ loading ? '登录中...' : '登录' }}</button>
            <div class="link-text">
                还没有账号？<a href="register.html">立即注册</a>
            </div>
        </form>
    </div>


    <!-- 引入API模块 -->
    <script type="module">
        import { authApi, saveLoginInfo, redirectWithToken } from './js/api.js';
        const { ElMessage } = ElementPlus;
        const { createApp, ref } = Vue;

        // Vue 应用实例
        createApp({
            setup() {
                // 响应式数据
                const form = ref({
                    username: '',
                    password: ''
                });
                const loading = ref(false);

                // 登录处理方法
                const handleLogin = async () => {
                    // 表单验证
                    if (!form.value.username) {
                        ElMessage.error('请输入用户名');
                        return;
                    }
                    if (!form.value.password) {
                        ElMessage.error('请输入密码');
                        return;
                    }
                    // 登录请求
                    loading.value = true;

                    authApi.login(form.value)
                        .then(result => {
                            // 保存登录信息
                            saveLoginInfo(result.token, result.user);
                            // 登录成功，使用XMLHttpRequest携带token跳转到行程管理页面
                            ElMessage.success('登录成功');
                            redirectWithToken('trip-management.html');
                        })
                        .catch(error => ElMessage.error('登录失败'))
                        .finally(() => loading.value = false);
                };

                // 跳转到注册页面
                const goToRegister = () => {
                    window.location.href = 'register.html';
                };

                // 返回需要在模板中使用的数据和方法
                return {
                    form,
                    loading,
                    handleLogin,
                    goToRegister
                };
            }
        }).use(ElementPlus).mount('#app');
    </script>
</body>

</html>